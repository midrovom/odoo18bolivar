<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="s_gallery_snippet" inherit_id="theme_prime.snippets" name="Products Gallery - 6 Registry">
    <xpath expr="//t[@t-snippet='theme_prime.s_d_products_snippet']" position="after">
      <t t-snippet="theme_prime_image.s_products_gallery"
         string="Products Gallery - 6"
         group="theme_prime_dynamic"
         t-thumbnail="/theme_prime_image/static/src/img/s_banner_custom/thumb_banner.png">
        <keywords>gallery, album, portfolio, products</keywords>
      </t>
    </xpath>
  </template>

  <template id="s_products_gallery" name="Products Gallery">
    <section class="s_products_gallery o_snippet py-4"
             data-oe-model="website.snippet"
             data-oe-field="category_id"
             data-oe-type="many2one"
             data-oe-expression="product.public.category">

      <t t-set="button_text" t-value="'COMPRAR'"/>
      <div class="container">
        <div class="row row-cols-2 row-cols-md-5 g-3">
          <t t-if="category_id">
            <t t-set="products"
               t-value="request.env['product.template'].sudo().search([('public_categ_ids','child_of', category_id)], limit=10)"/>
          </t>
          <t t-else="">
            <t t-set="products"
               t-value="request.env['product.template'].sudo().search([], limit=10)"/>
          </t>

          <!-- Iterar productos -->
          <t t-foreach="products" t-as="product">
            <div class="col">
              <div class="product-card text-center p-3 h-100">

                <!-- Imagen del producto -->
                <img t-att-src="'/web/image/product.template/%s/image_1920' % product.id"
                     t-att-alt="product.name"
                     class="img-fluid mb-2"/>

                <hr class="my-2"/>
                <h5 class="fw-bold text-truncate" t-att-title="product.name">
                  <t t-esc="product.name"/>
                </h5>
                <ul class="list-unstyled small text-muted text-start text-wrap">
                  <t t-foreach="product.attribute_line_ids" t-as="attr">
                    <t t-if="attr.attribute_id.name != 'Marca'">
                      <t t-foreach="attr.value_ids" t-as="val">
                        <li class="d-flex align-items-center mb-1 text-truncate">
                          <t t-if="val.dr_image">
                            <img t-att-src="'/web/image/product.attribute.value/%s/dr_image' % val.id"
                                 t-att-alt="val.name"
                                 class="attr-icon me-2"/>
                          </t>
                          <span><t t-esc="val.name"/></span>
                        </li>
                      </t>
                    </t>
                  </t>
                </ul>

                <!-- Precio + Botón responsivo -->
                <div class="d-flex flex-wrap justify-content-between align-items-center mt-auto">
                  <div class="price fw-bold mb-2 text-truncate">
                    $<t t-esc="product.list_price"/>
                  </div>
                  <form t-att-action="'/shop/cart/update'" method="post"
                        class="m-0 flex-grow-1 flex-md-grow-0">
                    <input type="hidden" name="product_id" t-att-value="product.id"/>
                    <button type="submit"
                            class="btn btn-primary rounded-pill btn-sm w-100 w-md-auto mt-2 mt-md-0"
                            data-oe-editable="true"
                            data-oe-expression="button_text">
                      <t t-esc="button_text or 'COMPRAR'"/>
                    </button>
                  </form>
                </div>

              </div>
            </div>
          </t>
        </div>
      </div>
    </section>
  </template>

  <!-- Opciones del snippet -->
  <template id="s_products_gallery_options" inherit_id="website.snippet_options" name="Products Gallery Options">
    <xpath expr="//div[@id='snippet_structure']" position="inside">
      <div data-js="s_products_gallery" data-selector=".s_products_gallery">
        <!-- Selector de color del botón -->
        <we-select string="Color del botón"
                   data-attribute="class"
                   data-selector="button"
                   data-no-preview="true">
          <we-option string="Primario" data-value="btn btn-primary"/>
          <we-option string="Secundario" data-value="btn btn-secondary"/>
          <we-option string="Éxito" data-value="btn btn-success"/>
          <we-option string="Peligro" data-value="btn btn-danger"/>
          <we-option string="Oscuro" data-value="btn btn-dark"/>
        </we-select>
      </div>
    </xpath>
  </template>
</odoo>
