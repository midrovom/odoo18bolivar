<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="s_clients_brand_snippet" inherit_id="theme_prime.snippets" name="Clients Brand Registry">
    <xpath expr="//t[@t-snippet='theme_prime.s_clients_4']" position="after">
      <t t-snippet="theme_prime_image.s_clients_brands"
         string="Clients - 5 (Marcas destacadas)"
         group="theme_prime_clients"
         t-thumbnail="/theme_prime_image/static/src/img/snippets/brands_thumb.png">
        <keywords>clients, brands, logo, reference</keywords>
      </t>
    </xpath>
  </template>

  <template id="s_clients_brands" name="Clients - Marcas destacadas">
    <section class="s_clients_brands o_snippet py-4">
      <div class="container text-center">
        <div class="row mb-3">
          <div class="col">
            <hr class="border-top border-2 mb-0"/>
            <h3 class="fw-bold bg-white d-inline-block px-3 position-relative" style="top:-1.2rem;">
              Marcas destacadas
            </h3>
          </div>
        </div>

        <!-- Desktop -->
        <div class="d-none d-md-block">
          <div class="d-flex flex-wrap justify-content-between align-items-center">
            <t t-set="brand_attr"
               t-value="request.env['product.attribute'].sudo().search([('name','=','Marca')], limit=1)"/>
            <t t-foreach="brand_attr.value_ids" t-as="brand" t-key="brand.id">
              <!-- Buscar si hay productos publicados con esta marca -->
              <t t-set="products"
                 t-value="request.env['product.template'].sudo().search([
                   ('website_published','=',True),
                   ('attribute_line_ids.value_ids','in', brand.id)
                 ], limit=1)"/>
              <t t-if="products">
                <a t-att-href="'/shop?attrib=%s-%s' % (brand.attribute_id.id, brand.id)"
                   class="brand-link text-decoration-none mx-2">
                  <t t-if="brand.dr_image">
                    <img t-att-src="'/web/image/product.attribute.value/%s/dr_image' % brand.id"
                         t-att-alt="brand.name"
                         class="brand-logo"/>
                  </t>
                  <t t-else="">
                    <span class="brand-name"><t t-esc="brand.name"/></span>
                  </t>
                </a>
              </t>
            </t>
          </div>
        </div>

        <!-- Móvil: scroll infinito -->
        <div class="d-md-none overflow-hidden">
          <div class="logo-slider d-flex align-items-center">
            <t t-set="brand_attr"
               t-value="request.env['product.attribute'].sudo().search([('name','=','Marca')], limit=1)"/>
            <t t-foreach="brand_attr.value_ids" t-as="brand" t-key="brand.id">
              <t t-set="products"
                 t-value="request.env['product.template'].sudo().search([
                   ('website_published','=',True),
                   ('attribute_line_ids.value_ids','in', brand.id)
                 ], limit=1)"/>
              <t t-if="products">
                <a t-att-href="'/shop?attrib=%s-%s' % (brand.attribute_id.id, brand.id)"
                   class="brand-link text-decoration-none mx-3 flex-shrink-0">
                  <t t-if="brand.dr_image">
                    <img t-att-src="'/web/image/product.attribute.value/%s/dr_image' % brand.id"
                         t-att-alt="brand.name"
                         class="brand-logo"/>
                  </t>
                  <t t-else="">
                    <span class="brand-name"><t t-esc="brand.name"/></span>
                  </t>
                </a>
              </t>
            </t>
            <!-- Duplicar para efecto infinito -->
            <t t-foreach="brand_attr.value_ids" t-as="brand" t-key="'dup-%s' % brand.id">
              <t t-set="products"
                 t-value="request.env['product.template'].sudo().search([
                   ('website_published','=',True),
                   ('attribute_line_ids.value_ids','in', brand.id)
                 ], limit=1)"/>
              <t t-if="products">
                <a t-att-href="'/shop?attrib=%s-%s' % (brand.attribute_id.id, brand.id)"
                   class="brand-link text-decoration-none mx-3 flex-shrink-0">
                  <t t-if="brand.dr_image">
                    <img t-att-src="'/web/image/product.attribute.value/%s/dr_image' % brand.id"
                         t-att-alt="brand.name"
                         class="brand-logo"/>
                  </t>
                  <t t-else="">
                    <span class="brand-name"><t t-esc="brand.name"/></span>
                  </t>
                </a>
              </t>
            </t>
          </div>
        </div>

        <!-- Línea inferior -->
        <div class="row mt-3">
          <div class="col">
            <hr class="border-top border-2"/>
          </div>
        </div>
      </div>

      <!-- Estilos -->
      <style>
        .s_clients_brands .brand-logo {
          max-height: 50px;
          filter: grayscale(100%);
          transition: all 0.3s ease;
        }
        .s_clients_brands .brand-name {
          font-weight: 600;
          font-size: 1.1rem;
          color: #6c757d;
          transition: all 0.3s ease;
        }
        .s_clients_brands .brand-link:hover .brand-logo {
          filter: grayscale(0%) saturate(2);
          transform: scale(1.05);
        }
        .s_clients_brands .brand-link:hover .brand-name {
          color: #28a745;
        }

        /* Infinite scroll logos en móvil */
        .logo-slider {
          display: flex;
          animation: scroll-logos 8s linear infinite;
        }
        @keyframes scroll-logos {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
      </style>
    </section>
  </template>
</odoo>
